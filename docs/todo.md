# TODO

## TODOリスト

- [x] ログイン管理ロジック実装
- [x] API連携（login.html→GAS doPost）
- [x] GAS Webアプリとして画面・API一体運用に設計変更
- [x] ログイン認証テスト実装・動作確認
- [x] ドキュメント整理・進捗反映
- [ ] 自動ログイン機能の実装
  - [ ] セッションIDのLocalStorage保存機能
  - [ ] 自動ログインフラグのデータベース反映
  - [ ] セッションによる認証機能
  - [ ] テスト・動作確認
- [ ] フォーム生成機能の実装

---

## 設計・実装方針（2025/04/20更新）
- ログイン画面（login.html）はGASのHTMLサービスでホストし、WebアプリURL（/exec）で直接アクセスできるようにした。
- 認証APIも同一URLで提供し、画面・APIの一元管理・CORS問題の完全回避を実現。
- GASのHTMLサービスでは、fetchではなく**google.script.run**を使ってサーバーサイド関数を直接呼び出す必要がある。
- サーバーサイド関数はトップレベルで定義し、クライアントからは`google.script.run.functionName()`の形で呼び出す。
- 今後もGAS Webアプリ内でUI・認証ロジック・APIを一体運用する方針。

## 実装で得られた知見（2025/04/20）

### GASのHTMLサービスとサーバーサイド関数の連携
- `google.script.run`でサーバーサイド関数を呼び出す際、複雑なオブジェクト（Dateオブジェクトなど）は正しく伝達されない場合がある。
- サーバー側では返却値を単純なオブジェクトに変換し、複雑な型は文字列化（`String()`）すると良い。
- クライアント側では結果の型チェックと適切な変換を行い、文字列比較（`String(result.success) === 'true'`）で判定すると安全。

### エラーハンドリングの重要性
- クライアント側とサーバー側の両方で詳細なログ出力と例外処理を実装することで、デバッグと問題解決が容易になる。
- 全体をtry-catchで囲み、予期せぬエラーにも対応することが重要。

## テスト観点
- WebアプリURLでログイン画面が正しく表示されること
- ID/PW認証APIが正常・異常系ともに正しく動作すること
- 画面・API連携にCORS等の問題が発生しないこと
